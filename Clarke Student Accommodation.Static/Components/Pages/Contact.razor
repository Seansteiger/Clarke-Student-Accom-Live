@page "/contact"
@inject IJSRuntime JSRuntime

<PageTitle>Contact Us - Clarke Student Accommodation</PageTitle>

<div class="contact-header">
    <div class="container">
        <h1>Get In Touch</h1>
        <p>We're here to answer your questions and help you find your new home</p>
    </div>
</div>

<div class="container contact-container">
    <div class="contact-grid">
        <div class="contact-info-section">
            <h2>Contact Information</h2>
            <p class="contact-intro">
                Feel free to reach out to us through any of the following methods. 
                We're happy to schedule viewings, answer questions about availability, 
                or provide more information about our accommodation.
            </p>

            <div class="contact-cards">
                <div class="contact-card">
                    <div class="contact-icon">üë§</div>
                    <h3>Property Management</h3>
                    
                    <div class="person-contact" style="margin-bottom: 1.5rem;">
                        <p class="contact-name" style="font-weight: bold; margin-bottom: 0.25rem;">Mr Dickens (Caretaker)</p>
                        <p class="contact-detail" style="margin-bottom: 0.25rem;">
                            <a href="tel:+27609969028">060 996 9028</a>
                        </p>
                        <p class="contact-sub" style="font-size: 0.9em; color: #666; margin-bottom: 0.25rem;">(Mobile & WhatsApp)</p>
                        <p class="contact-email">
                            <a href="mailto:dickensnyalugwe@gmail.com">dickensnyalugwe@gmail.com</a>
                        </p>
                    </div>

                    <div class="person-contact">
                        <p class="contact-name" style="font-weight: bold; margin-bottom: 0.25rem;">Mr Kenneth (Property Manager)</p>
                        <p class="contact-detail" style="margin-bottom: 0.25rem;">
                            <a href="tel:+27760908147">076 090 8147</a>
                        </p>
                        <p class="contact-sub" style="font-size: 0.9em; color: #666; margin-bottom: 0.25rem;">(Mobile & WhatsApp)</p>
                        <p class="contact-email">
                            <a href="mailto:magoenja@gmail.com">magoenja@gmail.com</a>
                        </p>
                        <p class="contact-note" style="font-size: 0.85em; font-style: italic; color: var(--color-primary); margin-top: 0.5rem;">
                            *Please direct all website queries & messages to Kenneth
                        </p>
                    </div>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">üí≥</div>
                    <h3>Payment Methods</h3>
                    <p class="contact-detail">
                        We accept the following payment methods:
                    </p>
                    <ul class="payment-list" style="list-style: none; padding: 0; margin-top: 1rem;">
                        <li style="margin-bottom: 0.5rem;">‚úÖ <strong>NSFAS</strong> Accredited</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ <strong>Bursaries</strong> Accepted</li>
                       <li>‚úÖ <strong>Cash</strong></li>
                    </ul>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">üìç</div>
                    <h3>Physical Address</h3>
                    <p class="contact-detail">
                        153 High Street<br />
                        Brixton<br />
                        Johannesburg, Gauteng<br />
                        South Africa
                    </p>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">üïí</div>
                    <h3>Viewing Hours</h3>
                    <p class="contact-detail">
                        Monday - Friday: 9:00 AM - 4:00 PM<br />
                        Saturday: 10:00 AM - 2:00 PM<br />
                        Sunday: By appointment only
                    </p>
                </div>
            </div>
        </div>

        <div class="contact-form-section">
            <div class="form-card">
                <h2>Send Us a Message</h2>
                <p class="form-intro">Fill out the form below and we'll get back to you as soon as possible.</p>
                
                <div class="form-notice" style="display:none;">
                    <!-- Hidden for production feel -->
                </div>

                <form class="contact-form" @onsubmit="HandleSubmit" @onsubmit:preventDefault>
                    <div class="form-group">
                        <label for="name">Full Name *</label>
                        <input type="text" id="name" @bind="formModel.Name" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" @bind="formModel.Email" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" @bind="formModel.Phone" class="form-control" />
                    </div>

                    <div class="form-group">
                        <label for="subject">Subject *</label>
                        <select id="subject" @bind="formModel.Subject" class="form-control" required>
                            <option value="">-- Select a subject --</option>
                            <option value="viewing">Schedule a Viewing</option>
                            <option value="availability">Check Availability</option>
                            <option value="pricing">Pricing Information</option>
                            <option value="general">General Inquiry</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="message">Message *</label>
                        <textarea id="message" @bind="formModel.Message" class="form-control" rows="6" required></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        Send Message
                    </button>

                    @if (!string.IsNullOrEmpty(submitMessage))
                    {
                        <div class="submit-message @(isSuccess ? "success" : "info")" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; background-color: var(--color-success); color: white;">
                            @submitMessage
                        </div>
                    }
                </form>
            </div>
        </div>
    </div>
</div>

@code {
    private ContactFormModel formModel = new();
    private string submitMessage = "";
    private bool isSuccess = false;

    private async Task HandleSubmit()
    {
        // Construct WhatsApp message (removed delay to avoid popup blocker issues)
        var message = $"Hi, inquiry from Clarke Student Accommodation website:\n\n" +
                     $"Name: {formModel.Name}\n" +
                     $"Email: {formModel.Email}\n" +
                     $"Phone: {formModel.Phone}\n" +
                     $"Subject: {formModel.Subject}\n\n" +
                     $"Message: {formModel.Message}";

        var encodedMessage = Uri.EscapeDataString(message);
        var whatsappUrl = $"https://wa.me/27760908147?text={encodedMessage}";

        // Open WhatsApp in a new tab
        await JSRuntime.InvokeVoidAsync("open", whatsappUrl, "_blank");
        
        submitMessage = "Thank you! You are being redirected to WhatsApp to complete your inquiry.";
        isSuccess = true;
        
        // Optional: clear form or keep it for reference
        // formModel = new ContactFormModel(); 
    }

    private class ContactFormModel
    {
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string Phone { get; set; } = "";
        public string Subject { get; set; } = "";
        public string Message { get; set; } = "";
    }
}
